<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>jQuery UI Autocomplete - Combobox</title>
    <!--<link rel="stylesheet" href="custom-theme/jquery-ui-1.9.2.custom.min.css">-->
    <link rel="stylesheet" href="themes/smoothness/jquery-ui-all.css" />
    <script src="lib/jquery-1.7.1.min.js"></script>
    <script src="lib/jquery-ui-1.9.2.min.js"></script>
    <link rel="stylesheet" href="demo.css">
   
        <script>
        var aSource = ["red","green","blue"];
        (function( $ ) {
            $.widget( "becky.combobox", {
                 options: {
                 theSource: [],
                 force: true,
                 inputId:null
                
                 },
                 getValue: function(){
                    return this.input.val();
                 },
                 removeFromSource: function(value){
                    var newSource = [];
                    for (var i=0;i<this.options.theSource.length;i++){
                        if (this.options.theSource[i] !== value){
                            newSource.push(this.options.theSource[i]);
                        }
                    }
                    this.options.theSource = newSource;
                    this.input.autocomplete("option","source",newSource);
                    this.input.val(this.options.theSource && this.options.theSource.length >0 ? this.options.theSource[0]: "");
                 },
                 addToSource: function(value){
                    this.options.theSource.push(value);
                    this.input.autocomplete("option","source",this.options.theSource);
                    this.input.val(this.options.theSource && this.options.theSource.length >0 ? this.options.theSource[0]: "");
                 },
                 _create: function() {
                        var options = this.options;
                        var that = this,
                              select = this.element.hide(),
                              selected = select.children( ":selected" ),
                              value = options.theSource && options.theSource.length >0 ? options.theSource[0]: "", //selected.val() ? selected.text() : "",
                              wrapper = this.wrapper = $( "<span>" )
                                     .addClass( "ui-combobox" )
                                     .insertAfter( select );
                                     
                        function removeIfInvalid(element) {
                              var value = $( element ).val(),
                                     matcher = new RegExp( "^" + $.ui.autocomplete.escapeRegex( value ) + "$", "i" ),
                                     valid = false;
                              select.children( "option" ).each(function() {
                                     if ( $( this ).text().match( matcher ) ) {
                                            this.selected = valid = true;
                                            return false;
                                     }
                              });
                               if ( !valid && options.force===true) {
                                     // remove invalid value, as it didn't match anything
                                     $( element )
                                            .val(options.theSource[0]) //.val( "" )
                                            .attr( "title", value + " didn't match any item - choose item from list" )
                                            .tooltip( "open" );
                                     select.val( "" );
                                     setTimeout(function() {
                                            that.input.tooltip( "close" ).attr( "title", "" );
                                     }, 2500 );
                                     that.input.data( "autocomplete" ).term = "";
                                     return false;
                              }
                        }

                        this.input = $( "<input>" )
                            .appendTo( wrapper )
                            .val( value )
                            .attr( "title", "" )
                            .addClass( "ui-state-default ui-combobox-input" )
                            .autocomplete({
                                     delay: 0,
                                     minLength: 0,
                                     source: options.theSource,
                                     select: function( event, ui ) {
                                            //ui.item.option.selected = true;
                                            that._trigger( "selected", event, {
                                                   //item: ui.item.option
                                                   item: ui.item.value
                                            });
                                     },
                                     change: function( event, ui ) {
                                            if ( options.theSource && options.theSource.length>0 &&  !ui.item )
                                                   return removeIfInvalid( this );
                                            //var v =$(this).val();
                                     }
                              })
                              .addClass( "ui-widget ui-widget-content ui-corner-left" );
                        this.input.data( "autocomplete" )._renderItem = function( ul, item ) {
                              return $( "<li>" )
                                     .data( "item.autocomplete", item )
                                     .append( "<a>" + item.label + "</a>" )
                                     .appendTo( ul );
                        };
                        if (options.inputId){
                            this.input.attr('id', options.inputId);
                        }
                        
                       $( "<a>" )
                              .attr( "tabIndex", -1 )
                              .attr( "title", "Show All Items" )
                              .tooltip()
                              .appendTo( wrapper )
                              .button({
                                     icons: {
                                            primary: "ui-icon-triangle-1-s"
                                     },
                                     text: false
                              })
                              .removeClass( "ui-corner-all" )
                              .addClass( "ui-corner-right ui-combobox-toggle" )
                              .click(function() {
                                     // close if already visible
                                     if ( that.input.autocomplete( "widget" ).is( ":visible" ) ) {
                                            input.autocomplete( "close" );
                                            //removeIfInvalid( input );
                                            return;
                                     }

                                     // work around a bug (likely same cause as #5265)
                                     $( this ).blur();

                                     // pass empty string as value to search for, displaying all results
                                     that.input.autocomplete( "search", "" );
                                     that.input.focus();
                              });

                              that.input.tooltip({
                                            position: {
                                                   of: this.button
                                            },
                                            tooltipClass: "ui-state-highlight"
                                     });
                 },

                 destroy: function() {
                       this.wrapper.remove();
                       this.element.show();
                       $.Widget.prototype.destroy.call( this );
                 }
              });
       })( jQuery );
       
       $(function() {
              $("#mycb").combobox({theSource:aSource,force:true,inputId:"myid"});
              
       });
       
      
       
        $(document).ready(function() {
            $("#demo_input").combobox({theSource:aSource,force:false,inputId:"demoid"});
            $("#add_btn").click(function(evt){
                var key =  $("#demo_input").combobox("getValue");//$("#demoid").val();
                if (key){
                    $("#demo_sel_list").append($("<option></option>").attr("value",key).text(key));
                }
                $("#demo_input").combobox("removeFromSource",key);
            });
            $("#remove_btn").click(function(evt){
                var key = $("#demo_sel_list").val();
                $("#demo_sel_list option[value='"+key +"']").each(function() {
                    $(this).remove();
                });
                $("#demo_input").combobox("addToSource",key);
            });
       });
   
       </script>
</head>
<body>
 

 
<h1>jquery-combobox demo (jQuery UI widget)</h1>
<p>A custom widget built by composition of Autocomplete and Button to provide ComboBox functionality. This is created for a specific use case in which you have and array of values or no values.  AJAX functionality is not included.  You can either type something into the field to get filtered suggestions based on your input, or use the button to get the full list of selections.  You can supply an array of data.  If data is supplied, first value in array will be used as value for input.  You can force use to use supplied data.  You can supply an DOM ID for the input.</p>
<div>Options:
<ul>
<li>theSource - an array of data that serves as selection values</li>
<li>force - forces the user to use data in the array</li>
<li>inputId - optional DOM ID </li>
<li>getValue - returns the value (selected or entered)</li>
<li>removeFromSource - removed an item from the autocomplete source</li>
<li>addToSource - adds an item to the autocomplete source</li>
</ul>
</div>
<h3>Example shows effect of setting 'force' to true.  User can only select from list.</h3>
<div >
       <div>
           <label>Enter or select: </label>
           <span id="mycb"></span>
       </div>
       <div class="code">
           <code> var aSource = ["red","green","blue"];</code>
           <pre>$("#mycb").combobox({theSource:aSource,force:true,inputId:"myid"});</pre>
       </div>
</div>

<h3>Example shows effect setting 'force' to false. User can select or enter from widget and add to list. When data is removed from list it is added back to widget source.</h3>

<div><label>Enter or select: </label>
<span id="demo_input"></span><span style="padding-left:50px"><input type="button" id="add_btn" value="Add" /></span>
</div>
<div>
<label > Items selected or entered:</label>
<select size="3" style="width: 200px" id="demo_sel_list" ></select>
<span style="padding-left:5px"><input type="button" id="remove_btn" value="Remove" /></span></div>


<h5> <a href="http://www.learningjquery.com/2010/06/a-jquery-ui-combobox-under-the-hood">Inspiration for this widget.</a></h5>

</body>
</html>
